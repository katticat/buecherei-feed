<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Bilderbücher – Bücherei Obernau</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 20px;
      background: #fff;
    }
    h1 {
      font-size: 1.4rem;
    }
    ul {
      padding-left: 1.2em;
    }
    li {
      margin: 0.9em 0;
    }
    a {
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <!--<h1>Aktuelle Bilderbücher</h1>-->
  <ul id="liste">
    <li>Lade Liste …</li>
  </ul>

  <script>
  function stripHtml(html) {
    const doc = new DOMParser().parseFromString(html || "", "text/html");
    return (doc.body.textContent || "").trim();
  }

  fetch("/feed/bilderbuecher")
    .then(r => r.text())
    .then(xmlText => {
      const xml = new DOMParser().parseFromString(xmlText, "text/xml");
      const items = [...xml.querySelectorAll("item")].slice(0, 15);

      const ul = document.getElementById("liste");
      ul.innerHTML = "";

      for (const item of items) {
        const rawTitle = (item.querySelector("title")?.textContent || "").trim();
        const link     = (item.querySelector("link")?.textContent || "").trim();

        let author = "";
        let bookTitle = rawTitle;

        // Trennen an erstem Doppelpunkt
        const idx = rawTitle.indexOf(":");
        if (idx > -1) {
          author = rawTitle.slice(0, idx).trim();
          bookTitle = rawTitle.slice(idx + 1).trim();
        }

        const descRaw = item.querySelector("description")?.textContent || "";
        const description = stripHtml(descRaw);

        const li = document.createElement("li");

        // Buchtitel (Hauptlink)
        const a = document.createElement("a");
        a.href = link || "#";
        a.textContent = bookTitle || "Ohne Titel";
        a.target = "_blank";
        a.rel = "noopener";
        li.appendChild(a);

        // Autor
        if (author) {
          const meta = document.createElement("div");
          meta.style.fontSize = "0.95em";
          meta.style.opacity = "0.8";
          meta.textContent = "Autor: " + author;
          li.appendChild(meta);
        }

        // Beschreibung
        if (description) {
          const p = document.createElement("div");
          p.style.fontSize = "0.95em";
          p.style.marginTop = "4px";
          p.textContent = description;
          li.appendChild(p);
        }

        ul.appendChild(li);
      }

      if (items.length === 0) {
        ul.innerHTML = "<li>Keine Einträge gefunden.</li>";
      }
    })
    .catch(() => {
      document.getElementById("liste").innerHTML =
        "<li>Liste konnte nicht geladen werden.</li>";
    });
</script>
</body>
</html>
